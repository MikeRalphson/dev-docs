/*!
* jQuery Feedback Me Plugin
*
* File:        jquery.feedback_me.js
* Version:     0.5.9.beta.1 (grab latest stable from https://github.com/vedmack/feedback_me/releases)
*
* Author:      Daniel Reznick
* Info:        https://github.com/vedmack/feedback_me
* Contact:     vedmack@gmail.com
* Twitter:     @danielreznick
* Q&A:         https://groups.google.com/forum/#!forum/daniels_code
*
* Copyright (c) 2014 Daniel Reznick, all rights reserved. released under the MIT license
*
* This source file is distributed in the hope that it will be useful, but
* WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
* or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
*/
var fm=function(e){"use strict";function a(e){return void 0===e.target&&(e.target=e.srcElement),e}function t(t,s){var d,i;return t=a(t),1===e(t.target).closest(".feedback_trigger").length?d=e(t.target).closest(".feedback_trigger")[0].className:1===e(t.target).closest(".feedback_content").length?d=e(t.target).closest(".feedback_content")[0].className:(void 0===s&&(s="left-top"),d=s),d.indexOf("left-top")!==-1?i="left-top":d.indexOf("left-bottom")!==-1?i="left-bottom":d.indexOf("right-top")!==-1?i="right-top":d.indexOf("right-bottom")!==-1&&(i="right-bottom"),k[i]}function s(t,s){var d,i,o={},l={};t=a(t),o.marginLeft="+=380px",l.marginLeft="-=380px",fm.getFmOptions(t,s).position.indexOf("right-")!==-1&&(o.marginRight="+=380px",l.marginRight="-=380px"),d=e(t.target).closest(".feedback_trigger"),1===d.length?i=d.next():(i=e(t.target).closest(".feedback_content"),d=i.prev()),0!==i.length&&0!==d.length||(void 0===s&&(s="left-top"),i=e("."+s).closest(".feedback_content"),d=i.prev()),d.hasClass("feedback_trigger_closed")?v===!0?(d.removeClass("feedback_trigger_closed"),i.removeClass("feedback_content_closed")):d.add(i).animate(o,150,function(){d.removeClass("feedback_trigger_closed"),i.removeClass("feedback_content_closed")}):(d.addClass("feedback_trigger_closed"),i.addClass("feedback_content_closed"),v===!1&&d.add(i).animate(l,150))}function d(t){if(t=a(t),!(1===e(".feedback_content").length&&e(".feedback_content").hasClass("feedback_content_closed")||1===e(t.target).closest(".feedback_content").length)){var s,d,i,o={};for(s in k)k.hasOwnProperty(s)&&(i=e("."+s).closest(".feedback_content"),d=i.prev(),d.hasClass("feedback_trigger_closed")||(v===!0?(d.addClass("feedback_trigger_closed"),i.addClass("feedback_content_closed")):(s.indexOf("left-")!==-1?o.marginLeft="-=380px":o.marginRight="-=380px",d.hasClass("feedback_kurama")||(d.addClass("feedback_kurama"),d.add(i).animate(o,150,function(){var a,t;a=e(this),t=a.next(),a.removeClass("feedback_kurama"),a.addClass("feedback_trigger_closed"),t.addClass("feedback_content_closed")})))))}}function i(e){var a=e.lastIndexOf("@");return a<e.length-1&&a>0&&e.indexOf("@@")===-1&&e.length>2}function o(s,d){s=a(s);var o=e(s.target).closest(".feedback_content"),l=t(s,d);return!(l.name_required===!0&&""===o.find(".feedback_name").val()||l.email_required===!0&&""===o.find(".feedback_email").val()||l.email_required===!0&&i(o.find(".feedback_email").val())===!1||l.message_required===!0&&""===o.find(".feedback_message").val()||l.radio_button_list_required===!0&&void 0===o.find("input[name=feedback_radio]:checked").val())}function l(a,t){var s,d=e("."+t+" [pattern]"),i=!0;if(d.length>0)for(s=0;s<d.length&&(i=!d[s].validity.patternMismatch,i!==!1);s++);return i}function n(a,t){var s=e("."+t+" [required]"),d=!0;return s.length>0&&(d=o(a,t)),d}function r(){var a=e().jquery.split(".");a[0]=+a[0],a[1]=+a[1],a[0]>1||1===a[0]&&a[1]>=7?e(document).on("click",document,function(e){d(e)}):e(document).delegate("body",document,function(e){d(e)})}function c(a){var t="",s="",d="",i="",o="",l="",n="",c="",_="",f="",u=" fm_clean ",b="",m="",p="",g="",k=""===a.name_pattern?"":'pattern="'+a.name_pattern+'"',v=a.name_required?"required":"",y=a.email_required?"required":"",h=a.message_required?"required":"",x=a.radio_button_list_required?"required":"",q=a.name_required&&a.show_asterisk_for_required?'<span class="required_asterisk">*</span>':"",w=a.email_required&&a.show_asterisk_for_required?'<span class="required_asterisk">*</span>':"",C=a.message_required&&a.show_asterisk_for_required?'<span class="required_asterisk">*</span>':"",O=a.radio_button_list_required&&a.show_asterisk_for_required?'<span class="required_asterisk">*</span>':"";a.bootstrap===!0&&(m=" fm_bootstrap ",p=" btn btn-primary ",g=" hero-unit jumbotron ",u="",b=""),a.jQueryUI===!0&&(b=" fm_jquery ",d=" ui-widget-header ui-corner-all ui-helper-clearfix ",i=" ui-dialog ui-widget ui-widget-content ui-corner-all ",o=" ui-dialog-titlebar ",l=" ui-dialog-title ",u="",m="",g="",p=""),a.show_radio_button_list===!0&&(_='<li><div class="radio_button_list_title_wrapper"><div class="radio_button_list_title">'+a.radio_button_list_title+O+'</div></div><div class="radio_button_list_wrapper">',_+='    <div class="radio_button_wrapper">',_+='        <input value="1" type="radio" name="feedback_radio" class="feedback_radio_1" '+x+"/>",_+='        <label for="feedback_radio_1">'+a.radio_button_list_labels[0]+"</label>",_+="    </div>",_+='    <div class="radio_button_wrapper">',_+='        <input value="2" type="radio" name="feedback_radio" class="feedback_radio_2"/>',_+='        <label for="feedback_radio_2">'+a.radio_button_list_labels[1]+"</label>",_+="    </div>",_+='    <div class="radio_button_wrapper">',_+='        <input value="3" type="radio" name="feedback_radio" class="feedback_radio_3"/>',_+='        <label for="feedback_radio_3">'+a.radio_button_list_labels[2]+"</label>",_+="    </div>",_+='    <div class="radio_button_wrapper">',_+='        <input value="4" type="radio" name="feedback_radio" class="feedback_radio_4"/>',_+='        <label for="feedback_radio_4">'+a.radio_button_list_labels[3]+"</label>",_+="    </div>",_+='    <div class="radio_button_wrapper">',_+='        <input value="5" type="radio" name="feedback_radio" class="feedback_radio_5"/>',_+='        <label for="feedback_radio_5">'+a.radio_button_list_labels[4]+"</label>",_+="    </div>",_+="</div></li>",f=" radio_button_list_present"),a.show_email===!0&&(n='<li>\t<label for="feedback_email">'+a.email_label+"</label> "+w+' <input type="email" class="feedback_email" '+y+' placeholder="'+a.email_placeholder+'"></input> </li>',c=" email_present"),a.show_form===!0&&(t='<form class="feedback_me_form"><ul><li>\t<label for="feedback_name">'+a.name_label+"</label> "+q+' <input type="text" class="feedback_name" '+v+' placeholder="'+a.name_placeholder+'" '+k+"></input> </li>"+n+'<li>\t<label for="feedback_message">'+a.message_label+"</label> "+C+' <textarea rows="5" class="feedback_message" '+h+' placeholder="'+a.message_placeholder+'"></textarea> </li>'+_+'<li>\t<button type="submit" onclick="fm.stopPropagation(event);fm.sendFeedback(event,\''+a.position+'\');" class="feedback_submit '+p+'">'+a.submit_label+"</button> </li></ul></form>"),void 0!==a.iframe_url&&(s='<iframe name="feedback_me_frame" class="feedback_me_frame" frameborder="0" src="'+a.iframe_url+'"></iframe>'),e("body").append("<div onclick=\"fm.stopPropagation(event);fm.triggerAction(event,'"+a.position+'\');" class="feedback_trigger feedback_trigger_closed '+a.position+d+u+b+m+g+'"><span class="feedback_trigger_text">'+a.trigger_label+"</span></div>"),e("body").append('<div class="feedback_content feedback_content_closed '+a.position+c+f+i+u+b+m+g+'"><div class="feedback_title '+d+o+'"><span class="'+l+'">'+a.title_label+"</span></div>"+t+s+a.custom_html+"</div>"),a.jQueryUI===!0&&e(".feedback_submit").button({icons:{primary:"ui-icon-mail-closed"}}),a.close_on_click_outside===!0&&r(),e(".feedback_me_form").submit(function(e){e.preventDefault()})}function _(e){void 0!==e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function f(e,a,t){var s={};s.marginLeft="-=380px",e.position.indexOf("right-")!==-1&&(s.marginRight="-=380px"),v===!0?(a.addClass("feedback_trigger_closed"),t.addClass("feedback_content_closed")):a.add(t).animate(s,150,function(){a.addClass("feedback_trigger_closed")})}function u(t){t=a(t);var s=e(t.target).closest(".feedback_content");s.find(".feedback_name").val(""),s.find(".feedback_message").val(""),s.find(".feedback_email").val(""),s.find(".feedback_me_form input[name=feedback_radio]").prop("checked",!1)}function b(s,d){var i,o,r,c=n(s,d),u=l(s,d),b=t(s,d);return s=a(s),c===!1||u===!1?void _(s):(r=e(s.target).closest(".feedback_content"),o=e(s.target).closest(".feedback_content").prev(),b.delayed_close===!0&&r.find(".feedback_submit").text(b.delayed_options.sending),i={name:r.find(".feedback_name").val(),message:r.find(".feedback_message").val(),email:r.find(".feedback_email").val(),radio_list_value:r.find(".feedback_me_form input[name=feedback_radio]:checked").val()},i=e.extend(b.custom_params,i),void e.ajax({type:"POST",url:b.feedback_url,data:i,beforeSend:function(){e.ajaxSettings.hasOwnProperty("beforeSend")&&e.ajaxSettings.beforeSend(),b.delayed_close===!1&&f(b,o,r)},success:function(){var a="";fm.clearInputs(s),b.delayed_close===!0&&(void 0===b.delayed_options.custom_html_success?(void 0!==b.delayed_options.success_color&&(a=' style="background-color:'+b.delayed_options.success_color+'" '),r.find(".feedback_submit").text(b.submit_label),f(b,o,r),e("body").append("<div "+a+' class="feedback-delayed-dlg success" onclick="fm.stopPropagation(event);"><span class="feedback-dlg-close" onclick="fm.closeFeedbackDelayedDlg();">X</span><span class="feedback-sucess-message"><span class="feedback-sucess-fail-message-inner"><span>'+b.delayed_options.send_success+"</span></span></span></div>"),setTimeout(function(){e(".feedback-delayed-dlg").fadeOut(function(){e(this).remove()})},b.delayed_options.delay_success_milliseconds)):(r.find(".feedback_submit").text(b.submit_label),f(b,o,r),e("body").append('<div class="feedback-delayed-custom-dlg success" onclick="fm.stopPropagation(event);">'+b.delayed_options.custom_html_success+"</div>"),setTimeout(function(){e(".feedback-delayed-custom-dlg").fadeOut(function(){e(this).remove()})},b.delayed_options.delay_success_milliseconds)))},error:function(){var a="";b.delayed_close===!0?void 0===b.delayed_options.custom_html_fail?(void 0!==b.delayed_options.fail_color&&(a=' style="background-color:'+b.delayed_options.fail_color+'" '),r.find(".feedback_submit").text(b.submit_label),e("body").append("<div "+a+' class="feedback-delayed-dlg fail" onclick="fm.stopPropagation(event);"><span class="feedback-dlg-close" onclick="fm.closeFeedbackDelayedDlg();">X</span><span class="feedback-fail-message"><span class="feedback-sucess-fail-message-inner"><span>'+b.delayed_options.send_fail+"</span></span></span></div>"),setTimeout(function(){e(".feedback-delayed-dlg").fadeOut(function(){e(this).remove()})},b.delayed_options.delay_fail_milliseconds)):(r.find(".feedback_submit").text(b.submit_label),e("body").append('<div class="feedback-delayed-custom-dlg fail" onclick="fm.stopPropagation(event);">'+b.delayed_options.custom_html_fail+"</div>"),setTimeout(function(){e(".feedback-delayed-custom-dlg").fadeOut(function(){e(this).remove()})},b.delayed_options.delay_fail_milliseconds)):console.log("Failed to send feedback (please double check your feedback_url parameter)")}}))}function m(){e(".feedback-delayed-dlg").fadeOut()}function p(){var e,a,t=document.body||document.documentElement,s=t.style,d="transition";if("string"==typeof s[d])return void(v=!0);for(e=["Moz","Webkit","Khtml","O","ms"],d=d.charAt(0).toUpperCase()+d.substr(1),a=0;a<e.length;a++)if("string"==typeof s[e[a]+d])return void(v=!0);v=!1}function g(a){var t,s,d={feedback_url:"",position:"left-top",jQueryUI:!1,bootstrap:!1,show_email:!1,show_radio_button_list:!1,close_on_click_outside:!0,name_label:"Name",email_label:"Email",message_label:"Message",radio_button_list_labels:["1","2","3","4","5"],radio_button_list_title:"How would you rate my site?",name_placeholder:"",email_placeholder:"",message_placeholder:"",name_pattern:"",name_required:!1,email_required:!1,message_required:!1,radio_button_list_required:!1,show_asterisk_for_required:!1,submit_label:"Send",title_label:"Feedback",trigger_label:"Feedback",custom_params:{},iframe_url:void 0,show_form:!0,custom_html:"",delayed_close:!0,delayed_options:{delay_success_milliseconds:2e3,delay_fail_milliseconds:2e3,sending:"Sending...",send_fail:"Sending failed.",send_success:"Feedback sent.",fail_color:void 0,success_color:void 0,custom_html_success:void 0,custom_html_fail:void 0}};s=e.extend(d.delayed_options,a.delayed_options),t=e.extend(d,a),t.delayed_options=s,k[t.position]=t,c(t),p(t)}var k={},v=!1;return{init:g,sendFeedback:b,getFmOptions:t,triggerAction:s,stopPropagation:_,clearInputs:u,closeFeedbackDelayedDlg:m}}(jQuery);